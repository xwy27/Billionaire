<h1><center>现代操作系统 期末项目 实验报告</center></h1>

<h2><center>Billionaire(<i>传奇大富翁</i>)</center></h2>

<center><img src="logo.jpg" width=200 height=200></img></center>

<center>
<h3>开发人员</h3>

**徐伟元 16340261**
**许倚安 16340265**
**熊永琦 16340258**
</center>

<h3>目录</h3>

<!-- TOC -->

- [游戏概述](#游戏概述)
- [游戏规则](#游戏规则)
- [游戏运行](#游戏运行)
- [游戏架构](#游戏架构)
- [游戏逻辑伪代码设计](#游戏逻辑伪代码设计)
- [项目分工](#项目分工)
- [开发细节](#开发细节)
- [覆盖知识点](#覆盖知识点)
- [视频展示](#视频展示)
- [后记/感想](#后记感想)

<!-- /TOC -->

<div STYLE="page-break-after: always;"></div>

### 游戏概述

Billionaire(*传奇大富翁*)是一款线下聚会的单机游戏。其基本游戏规则遵从传统意义上的大富翁游戏，玩家投骰子，前进，买地，买房子，收取过路费等。但本游戏在传统基础上，引入了 **技能** 系统。每回合初始阶段，系统会随机抽取一个技能，玩家可以使用或不使用技能。技能效果也各具特色：增益类，削弱类等。

~~(*相信你会和我一样，爱上这款游戏*)~~

项目源代码均已开源放在 [github](https://github.com/xwy27/Billionaire)。

### 游戏规则

4人游戏，游戏右侧边栏会标识当前回合玩家，显示个人信息以及输出事件信息。  
游戏主页面左下角有结束回合按钮，掷骰子按钮，右下角有技能按钮，买卖地皮，升级房子按钮

1. 人物动作规则

    每回合人物可执行以下动作；

    1. 初始阶段，系统随机抽取技能
    1. 掷骰子，人物前进
    1. 前进后，判断是否需要给过路费
        - 现金不足，则破产，结束游戏，人物底色变灰
    1. 使用/不使用技能
    1. 如果金钱充足，可以买地，建房子，升级房子
    1. 若房产属于自己，可以卖房子
    1. 结束回合(只有投掷过骰子，方可结束)

1. 建筑系统

    建筑分为以下级别：

    - 平地
    - 初级房子
    - 中级房子
    - 高级房子

    买地根据不同地皮花钱  
    ￥2000 升级一次

1. 金钱系统

    起始：15000

    支出
    - 买地
    - 建房子
    - 过路费

      过路费 = 地皮价格 * 房子增值系数 * 0.1  
      房子增值系数 = $2^{n}$，n = 房子升级次数
    <!-- - 机会卡罚款-->

    收入
    - 过路费
    <!-- - 机会卡奖励
    - 经过起点奖励(￥2000)-->
    - 银行卖地

      (地皮价格 + 升级花费) * 0.7

<!--1. 机会卡系统

    1. 回到起点
    1. 发钱(￥500/￥800)
    1. 罚钱(￥800/￥1000)
    1. 坐牢(跳过一回合)
-->

1. 技能系统

    1. 哄抬物价(提高所处位置的地价)
    1. 贸易战争(降低所处位置的低价)
    1. 拆迁办(半价拆除)
    1. 欺诈者(买地8折)

1. 结束清算

    1. 人物

      - 现金
      - 不动产(地皮价格 + 升级价格)
      - 总资产(现金 + 不动产)
      - 排名

### 游戏运行

1. 将 class 和 recourse 文件夹覆盖一个 cocos 项目后，可编译运行
1. 使用当前目录下的 Billionaire.exe

### 游戏架构

游戏代码抽象分离出三个模块：场景(UI)模块，动画模块以及控制模块。

- 场景(UI)模块

  负责场景信息更新，包括当前玩家标识，玩家信息和事件信息显示

- 动画模块

  负责动画效果的执行，包括人物移动，技能动画

- 控制模块

  负责游戏状态的检测与更新，包括人物状态，地皮状态以及回合状态

  人物状态:金钱／位置／房产  
  地皮状态:价格／升级次数／拥有者  
  回合状态:当前玩家／骰子点数(0标志未投)／技能id／技能释放标志

### 游戏逻辑伪代码设计

- 场景模块(Scene)

  ```cpp
  void GameStart(); // 调用动画模块／控制系统初始化方法
  void RoundStart(){
    /* 显示当前玩家
    * getUserID()
    * 从游戏状态获取当前玩家id
    * 改底色
    */

    /*
      * updatePlayerState();
      */

    /* 技能 bling
    * newSkillID()
    * 从游戏状态获取技能id
    * skillBling();
    * 通知动画模块显示技能 bling 动画
    */
  }

  void playerLose(); // 玩家破产，底色变灰色

  void updatePlayerState() {
    // 更新右上角玩家信息栏
    // 更新金钱 getMoney()
  }

  void log(stirng msg) {
    // 显示 msg 信息
  }

  void roundEnd() {
    if (扔了筛子 isRolled()) {
      // 当前玩家回合结束 nextPlayer()
    }
  }
  ```

- 动画模块

  ```cpp
  void initial() {
    //放置人物
  }

  void skillBling();

  void playerMove(int id, int pos, int steps) {
    // 移动
    // 回调 payCharge()
  }
  ```

- 控制系统

  - 游戏状态
    - 人物状态
      金钱／位置／房产
    - 地皮状态
      价格／升级次数／拥有者
    - 回合状态
      当前玩家／骰子点数(0标志未投)／技能id／技能释放标志

  ```cpp
  void initial(); // 初始化游戏状态

  int getUserID();
  int newSkillID(); // random 一下
  int getSkillID();
  int getMoney(); // 更新当前玩家金钱

  int roll() {
    // random 修改当前状态下的骰子点数
    // log(骰子点数)
    // playerMove(int id, int pos, int steps)
    // 更新人物位置
  }

  void payCharge(){
    // 给过路费
    // log()
    // 更新金钱
    // updatePlayerState()
    // 判断破产(yes的话，调用UI模块的playerLose(), log())
  }

  void useSkill() {
    // 更新技能释放标志
    // log()
  }

  void buyLand() {
    /* if (地无主 && 钱够) {
        更新当前地皮的所有者
        地皮id插入当前人物的房产列表
        扣钱
        log()
        updatePlayerState()
      }
    */
  }

  void upgradeLand() {
    /*
      if (地属于自己 && 钱够 && 地还能升级) {
        更新地皮升级次数
        扣钱
        log()
        updatePlayerState()
      }
    */
  }

  void sellLand() {
    /*
      if (地属于自己) {
        更新当前地皮的所有者
        地皮id从当前人物的房产列表中删除
        加钱
        log()
        updatePlayerState()
      }
    */
  }

  bool isRolled();

  void nextPlayer() {
    // 重置为回合初始状态
    // roundStart()
  }
  ```

### 项目分工

- 徐伟元(**场景模块**)
- 许倚安(**动画模块 + 美工小姐姐**)
- 熊永琦(**控制模块**)

### 开发细节

### 覆盖知识点

### 视频展示

### 后记/感想

1. 徐伟元
  忙忙碌碌三星期，说是做作业，但更像是一次体验之旅。回想开发过程，开始对着作业要求写，后面对着自己想法做，最终回来看要求，真的是让人发笑。
  这么一个团队开发的小型本地项目，可以说找不出什么优点了，不过 UI 还是挺简约耐看的。至少在前后端对接成功的时候，是很开心了。
  感谢队友琦哥和骑安的包容了，什么都不懂，然后疯狂 diss 的 CTO，是我了。总之，至少完成了基本期望吧，各背各锅，最终成功运行，很开心了。
  开发时，最庆幸的事情就是使用 [github](https://github.com/xwy27/iSharing) 进行项目代码管理，没有出过差错。不像以前，需要版本回退，重新开工(orz)。
  希望继续努力吧。
1. 许倚安
  感谢委员大佬与琦哥带飞！感觉自己一直在拖DDL超级不好意思了……
  委员一直督促我注意代码格式与注释的完整性，让我稍微有那么一点写注释的意识了！
  还有各种特别的小技巧解决问题，例如如何完成BitmapImage与Strem之间的转换：不能直接转换可以选择本地图片来转换。
  琦哥的服务器完成得好早，DEBUG也飞快的~
  第一次跟其他人合作完成一个项目，有点小激动，学到了很多啊，如何分锅、各部分如何合成等等，委员大佬辛苦啦！
1. 熊永琦
  本次项目我们采用了客户端/服务端分离的模式，这虽然使得每个人的任务有更低的耦合程度，但是给我们带来了额外的对接上的问题。得益于伟元同学优秀的项目管理能力，以及完备的项目管理方案，我们的开发过程还算比较顺利。不过在对接过程中还是遇到了一些问题——在最后合并测试的时候，我们发现了一个诡异的 Bug —— 物品信息无法更新。因为当时在修改一些服务端的细节，我们理所应当的以为这个问题是服务端的更改导致的，在之上浪费了相当多时间。可是在穷尽了各种方法后，我们却意外地发现问题出在客户端……这侧面说明了一个完备的单元测试对于一个模块众多、架构复杂的项目有多重要。
  总的来说，这次项目让我获益良多，不仅更熟悉了 UWP 程序的网络接口细节，更了解了如何和团队完成一个架构完整的项目。相信这对我之后的学习和工作都大有裨益。最后由衷感谢两位大腿带飞半期项目:D